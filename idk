-- FIX:
-- AUTO-DELETE PREVIOUS GUI ON RE-EXECUTION
-- COLOR THEME MATCHES PROVIDED IMAGE (PURPLE PANEL, DARK ACCENTS)
-- SETTINGS PANEL SEMI-TRANSPARENT
-- BLOXSTRAP BUTTON PURPLE THEME
-- PURPLE GLOW TEXT
-- TEXT FITS PERFECTLY
-- CLICK ANIMATION PRESERVED

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
if not player then return end

local GUI_NAME = "FreezeGui"

-- DELETE OLD GUI
local pg = player:WaitForChild("PlayerGui")
local oldGui = pg:FindFirstChild(GUI_NAME)
if oldGui then oldGui:Destroy() end

local FREEZE_TIME = 1
local DRAG_ENABLED = true

-- TEXT SIZES
local FREEZE_TEXT_SIZE = 48
local FREEZING_TEXT_SIZE = 28

-- COLOR THEME (MATCH IMAGE)
local PANEL_PURPLE = Color3.fromRGB(135, 70, 190)
local PANEL_BORDER = Color3.fromRGB(60, 80, 120)
local BUTTON_PURPLE = Color3.fromRGB(150, 80, 210)
local BUTTON_PURPLE_DARK = Color3.fromRGB(120, 60, 180)
local GLOW_PURPLE = Color3.fromRGB(200, 150, 255)
local TEXT_WHITE = Color3.fromRGB(240, 240, 255)
local GRAY = Color3.fromRGB(130, 130, 130)

-- UI ROOT
local gui = Instance.new("ScreenGui")
gui.Name = GUI_NAME
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = pg

-- FRAME
local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(200, 90)
frame.Position = UDim2.fromOffset(20, 70)
frame.BackgroundColor3 = PANEL_PURPLE
frame.BackgroundTransparency = 0.25
frame.BorderSizePixel = 0
frame.Active = true
frame.Parent = gui

local frameStroke = Instance.new("UIStroke")
frameStroke.Color = PANEL_BORDER
frameStroke.Thickness = 3
frameStroke.Parent = frame

-- DRAG TOGGLE
local dragToggle = Instance.new("TextButton")
dragToggle.Size = UDim2.fromOffset(36, 18)
dragToggle.Position = UDim2.new(1, -40, 0, 4)
dragToggle.BackgroundColor3 = PANEL_PURPLE
dragToggle.BackgroundTransparency = 0.25
dragToggle.BorderSizePixel = 0
dragToggle.Text = "ON"
dragToggle.Font = Enum.Font.GothamBold
dragToggle.TextSize = 12
dragToggle.TextColor3 = TEXT_WHITE
dragToggle.ZIndex = 10
dragToggle.Parent = frame

dragToggle.MouseButton1Click:Connect(function()
	DRAG_ENABLED = not DRAG_ENABLED
	dragToggle.Text = DRAG_ENABLED and "ON" or "OFF"
end)

-- MAIN BUTTON
local button = Instance.new("TextButton")
button.Size = UDim2.fromScale(1,1)
button.BackgroundTransparency = 1
button.Text = "FREEZE"
button.Font = Enum.Font.GothamBold
button.TextSize = FREEZE_TEXT_SIZE
button.TextColor3 = TEXT_WHITE
button.AutoButtonColor = false
button.ZIndex = 2
button.Parent = frame

-- OUTLINE / GLOW
local outlineOffsets = {
	Vector2.new(-2,0), Vector2.new(2,0),
	Vector2.new(0,-2), Vector2.new(0,2),
	Vector2.new(-2,-2), Vector2.new(2,2),
	Vector2.new(-2,2), Vector2.new(2,-2),
}

local outlines = {}
for _, offset in ipairs(outlineOffsets) do
	local o = button:Clone()
	o.TextColor3 = GLOW_PURPLE
	o.ZIndex = 1
	o.Position = UDim2.fromOffset(offset.X, offset.Y)
	o.Active = false
	o.Selectable = false
	o.Parent = frame
	table.insert(outlines, o)
end

-- SETTINGS BUTTON
local settingsBtn = Instance.new("TextButton")
settingsBtn.Size = UDim2.fromOffset(26, 26)
settingsBtn.Position = UDim2.new(1, -30, 1, -30)
settingsBtn.BackgroundColor3 = PANEL_PURPLE
settingsBtn.BackgroundTransparency = 0.25
settingsBtn.BorderSizePixel = 0
settingsBtn.Text = "⚙"
settingsBtn.Font = Enum.Font.GothamBold
settingsBtn.TextSize = 18
settingsBtn.TextColor3 = TEXT_WHITE
settingsBtn.ZIndex = 20
settingsBtn.Parent = frame

local settingsStroke = Instance.new("UIStroke")
settingsStroke.Color = PANEL_BORDER
settingsStroke.Thickness = 2
settingsStroke.Parent = settingsBtn

-- SETTINGS PANEL (TRANSLUCENT PURPLE)
local panel = Instance.new("Frame")
panel.Size = UDim2.fromOffset(180, 130)
panel.Position = UDim2.new(1, 6, 0, 0)
panel.BackgroundColor3 = PANEL_PURPLE
panel.BackgroundTransparency = 0.35
panel.BorderSizePixel = 0
panel.Visible = false
panel.ZIndex = 25
panel.Parent = frame

local panelStroke = Instance.new("UIStroke")
panelStroke.Color = PANEL_BORDER
panelStroke.Thickness = 2
panelStroke.Parent = panel

settingsBtn.MouseButton1Click:Connect(function()
	panel.Visible = not panel.Visible
end)

-- PANEL LABEL
local panelLabel = Instance.new("TextLabel")
panelLabel.Size = UDim2.fromScale(1, 0.18)
panelLabel.BackgroundTransparency = 1
panelLabel.Text = "DELAY (0.1–100s)"
panelLabel.Font = Enum.Font.GothamBold
panelLabel.TextSize = 12
panelLabel.TextColor3 = TEXT_WHITE
panelLabel.ZIndex = 26
panelLabel.Parent = panel

-- DELAY BOX
local delayBox = Instance.new("TextBox")
delayBox.Size = UDim2.fromScale(0.85, 0.25)
delayBox.Position = UDim2.fromScale(0.075, 0.22)
delayBox.BackgroundColor3 = PANEL_PURPLE
delayBox.BackgroundTransparency = 0.35
delayBox.BorderSizePixel = 0
delayBox.Text = tostring(FREEZE_TIME)
delayBox.Font = Enum.Font.GothamBold
delayBox.TextSize = 16
delayBox.TextColor3 = TEXT_WHITE
delayBox.ClearTextOnFocus = false
delayBox.ZIndex = 26
delayBox.Parent = panel

local delayStroke = Instance.new("UIStroke")
delayStroke.Color = PANEL_BORDER
delayStroke.Thickness = 1.5
delayStroke.Parent = delayBox

delayBox.FocusLost:Connect(function()
	local v = tonumber(delayBox.Text)
	if v then
		FREEZE_TIME = math.clamp(v, 0.1, 100)
	end
	delayBox.Text = string.format("%.1f", FREEZE_TIME)
end)

-- BLOXSTRAP BUTTON (PURPLE, GLOW TEXT)
local execBtn = Instance.new("TextButton")
execBtn.Size = UDim2.fromScale(0.85, 0.32)
execBtn.Position = UDim2.fromScale(0.075, 0.55)
execBtn.BackgroundColor3 = BUTTON_PURPLE
execBtn.BorderSizePixel = 0
execBtn.Text = "INSTALL BLOXTRAP SCRIPT"
execBtn.Font = Enum.Font.GothamBold
execBtn.TextScaled = true
execBtn.TextWrapped = true
execBtn.TextColor3 = GLOW_PURPLE
execBtn.ZIndex = 26
execBtn.Parent = panel

local execStroke = Instance.new("UIStroke")
execStroke.Color = PANEL_BORDER
execStroke.Thickness = 1.5
execStroke.Parent = execBtn

local pressTween = TweenService:Create(
	execBtn,
	TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	{BackgroundColor3 = BUTTON_PURPLE_DARK}
)

local releaseTween = TweenService:Create(
	execBtn,
	TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	{BackgroundColor3 = BUTTON_PURPLE}
)

execBtn.MouseButton1Down:Connect(function()
	pressTween:Play()
end)

execBtn.MouseButton1Up:Connect(function()
	releaseTween:Play()
end)

execBtn.MouseButton1Click:Connect(function()
	loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-OP-bloxstrap-mobile-71317"))()
end)

-- DRAG LOGIC
local dragging, dragStart, startPos

button.InputBegan:Connect(function(input)
	if not DRAG_ENABLED then return end
	if input.UserInputType == Enum.UserInputType.MouseButton1
	or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and DRAG_ENABLED and (
		input.UserInputType == Enum.UserInputType.MouseMovement
		or input.UserInputType == Enum.UserInputType.Touch
	) then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
end)

button.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1
	or input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)

-- FREEZE ACTION
button.MouseButton1Click:Connect(function()
	button.Text = "FREEZING..."
	button.TextSize = FREEZING_TEXT_SIZE
	for _, o in ipairs(outlines) do
		o.Text = "FREEZING..."
		o.TextSize = FREEZING_TEXT_SIZE
	end

	task.wait()

	local t = os.clock()
	while os.clock() - t < FREEZE_TIME do end

	button.Text = "FREEZE"
	button.TextSize = FREEZE_TEXT_SIZE
	for _, o in ipairs(outlines) do
		o.Text = "FREEZE"
		o.TextSize = FREEZE_TEXT_SIZE
	end
end)
